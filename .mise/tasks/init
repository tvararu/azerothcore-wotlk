#!/usr/bin/env bash
#MISE description="Generate docker-compose.override.yml if missing"
set -euo pipefail

REPO_ROOT="$(git rev-parse --show-toplevel)"
OVERRIDE="$REPO_ROOT/docker-compose.override.yml"

if [[ -f "$OVERRIDE" ]]; then
  echo "docker-compose.override.yml already exists, skipping."
  exit 0
fi

cat > "$OVERRIDE" << 'EOF'
services:
  ac-worldserver:
    tty: false
    environment:
      # Sync realm time with host timezone
      TZ: "Asia/Bangkok"
      # Required for mod-individual-progression
      AC_ENABLE_PLAYER_SETTINGS: "1"
      AC_DBC_ENFORCE_ITEM_ATTRIBUTES: "0"
      # Enable SOAP API for scripted commands
      AC_SOAP_ENABLED: "1"
      AC_SOAP_IP: "0.0.0.0"
      # Playerbots: enable random bots roaming the world
      AC_AI_PLAYERBOT_RANDOM_BOT_AUTOLOGIN: "1"
      # Playerbots: recycle max-level bots back to level 1
      AC_AI_PLAYERBOT_DOWNGRADE_MAX_LEVEL_BOT: "1"
      # Playerbots: cycle bots in/out from a larger pool (2x online count)
      AC_AI_PLAYERBOT_ENABLE_PERIODIC_ONLINE_OFFLINE: "1"
      # Playerbots: only run bots when a real player is online
      AC_AI_PLAYERBOT_DISABLED_WITHOUT_REAL_PLAYER: "1"
      # Playerbots: bots form guilds with nearby bots
      AC_AI_PLAYERBOT_RANDOM_BOT_GUILD_NEARBY: "1"
      # Playerbots: bots have quest history matching their level
      AC_AI_PLAYERBOT_PRE_QUESTS: "1"
      # Playerbots: enable auto-updates for the playerbots database
      AC_PLAYERBOTS_UPDATES_ENABLE_DATABASES: "1"
      # AH bot: full config surface from mod_ahbot.conf.dist
      # Set account/guid to a dedicated AH bot character.
      AC_AUCTION_HOUSE_BOT_DEBUG: "0"
      AC_AUCTION_HOUSE_BOT_DEBUG_CONFIG: "0"
      AC_AUCTION_HOUSE_BOT_DEBUG_FILTERS: "0"
      AC_AUCTION_HOUSE_BOT_DEBUG_BUYER: "0"
      AC_AUCTION_HOUSE_BOT_DEBUG_SELLER: "0"
      AC_AUCTION_HOUSE_BOT_TRACE_SELLER: "0"
      AC_AUCTION_HOUSE_BOT_TRACE_BUYER: "0"
      AC_AUCTION_HOUSE_BOT_ENABLE_SELLER: "1"
      AC_AUCTION_HOUSE_BOT_ENABLE_BUYER: "1"
      AC_AUCTION_HOUSE_BOT_USE_BUY_PRICE_FOR_SELLER: "0"
      AC_AUCTION_HOUSE_BOT_USE_BUY_PRICE_FOR_BUYER: "0"
      AC_AUCTION_HOUSE_BOT_USE_MARKET_PRICE_FOR_SELLER: "0"
      AC_AUCTION_HOUSE_BOT_MARKET_RESET_THRESHOLD: "25"
      AC_AUCTION_HOUSE_BOT_ACCOUNT: "0"
      AC_AUCTION_HOUSE_BOT_GUID: "0"
      AC_AUCTION_HOUSE_BOT_ITEMS_PER_CYCLE: "200"
      AC_AUCTION_HOUSE_BOT_CONSIDER_ONLY_BOT_AUCTIONS: "0"
      AC_AUCTION_HOUSE_BOT_DUPLICATES_COUNT: "0"
      AC_AUCTION_HOUSE_BOT_DIVISIBLE_STACKS: "0"
      AC_AUCTION_HOUSE_BOT_ELAPSING_TIME_CLASS: "1"
      AC_AUCTION_HOUSE_BOT_VENDOR_ITEMS: "1"
      AC_AUCTION_HOUSE_BOT_VENDOR_TRADE_GOODS: "1"
      AC_AUCTION_HOUSE_BOT_LOOT_ITEMS: "1"
      AC_AUCTION_HOUSE_BOT_LOOT_TRADE_GOODS: "1"
      AC_AUCTION_HOUSE_BOT_OTHER_ITEMS: "1"
      AC_AUCTION_HOUSE_BOT_OTHER_TRADE_GOODS: "1"
      AC_AUCTION_HOUSE_BOT_PROFESSION_ITEMS: "1"
      AC_AUCTION_HOUSE_BOT_NO_BIND: "1"
      AC_AUCTION_HOUSE_BOT_BIND_WHEN_PICKED_UP: "0"
      AC_AUCTION_HOUSE_BOT_BIND_WHEN_EQUIPPED: "1"
      AC_AUCTION_HOUSE_BOT_BIND_WHEN_USE: "1"
      AC_AUCTION_HOUSE_BOT_BIND_QUEST_ITEM: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_PERM_ENCHANT: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_CONJURED: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_GEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_MONEY: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_MONEY_LOOT: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_LOOTABLE: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_KEYS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_DURATION: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_BOP_OR_QUEST_NO_REQ_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_WARRIOR_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_PALADIN_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_HUNTER_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ROGUE_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_PRIEST_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_DK_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_SHAMAN_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_MAGE_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_WARLOCK_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_UNUSED_CLASS_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_DRUID_ITEMS: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_BELOW_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_ABOVE_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_BELOW_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_ABOVE_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_BELOW_GUID: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_ABOVE_GUID: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_BELOW_GUID: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_ABOVE_GUID: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_BELOW_REQ_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_ABOVE_REQ_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_BELOW_REQ_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_ABOVE_REQ_LEVEL: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_BELOW_REQ_SKILL_RANK: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_ITEMS_ABOVE_REQ_SKILL_RANK: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_BELOW_REQ_SKILL_RANK: "0"
      AC_AUCTION_HOUSE_BOT_DISABLE_TGS_ABOVE_REQ_SKILL_RANK: "0"
      AC_AUCTION_HOUSE_BOT_SELLER_WHITE_LIST: ""
    ports:
      # Expose playerbots TCP command server for external tools (OpenClaw)
      - "8888:8888"
    volumes:
      # Mount modules so worldserver can access module SQL at runtime
      - ./modules:/azerothcore/modules:ro
EOF

echo "Created docker-compose.override.yml"
